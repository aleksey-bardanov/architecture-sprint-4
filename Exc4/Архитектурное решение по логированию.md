# Архитектурное решение по логированию

Список логов уровня INFO

- Изменение статуса заказа. Логируем время, идентификатор покупателя, номер заказа.
- Действия пользователя (регистрация, заказ, оплата). Логируем время, идентификатор, действие.
- Действия продавцов (подтверждение заказа, выставление счета). Логируем время, идентификатор, действие.
- Действия операторов. Логируем время, идентификатор, действие.
- Запросы через MES API. Логируем время, идентификатор отправителя, действие.

## Мотивация 

Наряду с трейсингом логирование позволит определить места в системе, подверженные сбоям, а также позволит быстрее проводить расследование инцидентов и отвечать на жалобы клиентов при обращении c жалобами.

Помимо поиска причин задержек введение логирования должно повлиять на ряд бизнес-метрик, связанных с активностью пользователей:

- LTV. Lifetime value — пожизненная ценность клиента: сколько денег принёс пользователь за всё время, что он покупает продукцию.
- ARPU. Average revenue per user — средний доход с пользователя. С помощью этой метрики можно оценить всю выручку, которую бизнес заработал с одного пользователя за определённый период
- Churn Rate. Отток клиентов: сколько человек отказались пользоваться продуктом.
- DAU, WAU, MAU. Day, week, month active users — дневная, недельная, месячная активность аудитории. Количество уникальных пользователей за соответствующий период.
- ER. Engagement rate — коэффициент вовлечённости. Насколько активно люди пользуются продуктом.

## Предлагаемое решение

Предлагается развернуть систему анализа логов на базе стека ELK. Так как объем логов пока не большой, можно иметь один индекс на систему. Размер индексов можно ограничить заводя новый индекс каждый день. При экспорте данных из сервисов следует убедится, что на хранение не передается личная информация пользователей и информация, которая касается деталей финансовых операций. В качестве дополнительной меры предосторожности следует предусмотреть аутентификацию пользователей, осуществляющих работу с данными.

Диаграмма контейнеров представлена в [приложении](./LoggingArchitecture.puml)

## Система анализа логов

1. Слежение за изменением статуса заказа. Следует определить таймауты для обновления статусов и оповещать при их наступлении. Например если заказ не взят в разботу в течение суток после оплаты - это скорее всего инцидент, который требуется расследовать.
2. Превышение порогового значения RPS для внешнего B2B API. Возможно происходит DDoS-атака