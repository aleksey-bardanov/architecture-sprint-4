# Архитектурное решение по кешированию

## Мотивация

Приложение MES находится под нагрузкой: 
- Приложение обслуживает запросы на расчет стоимости из интернет магазина
- Приложение обслуживает запросы на расчет стоимости от внешних заказчиков через открытый API
- Через приложение проходят запросы от операторов, операторам важно видеть самые новые заказы, чтобы брать их в работу

Судя по описанию один экземпляр приложения принимает запросы как от операторов, так и от внешних пользователей, при этом делая запросы на чтение 3D моделей к единственному хранилищу, а также отправляет запросы на запись и на чтение в единственную базу данных. Так как не сазано иного предполагаю, что за актуальными данными для операторов приложение каждый раз обращаются непосредственно в базу данных.

### Важные предпосылки исходя из которых было выбрано решение

- Производство изделий длится до одного месяца, поэтому можно предположить, что данные по отдельном заказам меняются не часто.
- Данные должны обновляться синхронно у всех операторов, чтобы не было случаев, когда один заказ взят в работу разными операторами.
- Основная нагрузка на БД - запросы на чтение.
- Пик запросов приходится на начало рабочего дня, когда операторы выгружают данные и забирают новые заказы.


## Предлагаемое решение

Добавить кеш на запись и на чтение, используя комбинацию паттернов ReadTrough/WrightTrough. При этом кеш останется консистентным, а запросы на чтение будут выполняться быстрее.

## Диаграмма последовательности действий

Запись в БД системы управления производством производится по алгоритму [WrightTrough](./WrightTrough.puml).
Считывание данных из БД системы управления производством производится по алгоритму [ReadTrough](./ReadTrough.puml).

##  Стратегия инвалидации кеша

Перед началом рабочего дня сбрасывать кеш и прогревать его, выбирая все заказы за последний месяц (столько длится работа над одним заказом), чтобы в кеше были только актуальные заказы. При такой стратегии в начале рабочего дня операторы будут получать данные о новых заказах из кеша и не грузить базу данных однотипными запросами.